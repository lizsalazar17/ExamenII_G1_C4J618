---
title: "ExamenII_G1_C4J618_Liz_Salazar"
author: "Liz de María Salazar Amaya"
date: 11-30-2025
format: 
  html:
    toc: true
    theme: cosmo
    self-contained: true
    toc-float: true
---

# Parte de R

Link del repositorio: https://github.com/lizsalazar17/ExamenII_G1_C4J618.git

Primero, cargaremos la data de moras.txt


```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(scales)

df <- read_csv("../data/moras.txt")
head(df)


```


## 1. Resumen de 5 números

Para edad: 
```{r}

df %>%
  summarise(
    Categoria = "Edad",
    Media = mean(EDAD, na.rm = TRUE),
    Mediana = median(EDAD, na.rm = TRUE),
    Desviacion = sd(EDAD, na.rm = TRUE),
    Minimo = min(EDAD, na.rm = TRUE),
    Maximo = max(EDAD, na.rm = TRUE),
  )
df %>% 
  summarise(
    Categoria = "Salario",
    Media = mean(SALARIO, na.rm = TRUE),
    Mediana = median(SALARIO, na.rm = TRUE),
    Desviacion = sd(SALARIO, na.rm = TRUE),
    Minimo = min(SALARIO, na.rm = TRUE),
    Maximo = max(SALARIO, na.rm = TRUE),
  ) 
  
  
```
  ## 3-Valores atípicos
  
```{r}
  promedio.edad <- mean(df$EDAD, na.rm = TRUE)
  desviacion.edad <- sd(df$EDAD, na.rm = TRUE)
  
  promedio.salario <- mean(df$SALARIO, na.rm = TRUE)
  desviacion.salario<- sd(df$SALARIO, na.rm = TRUE)

df.modificada <- 
df %>% 
  mutate (
    Z_SCORE_EDAD= (EDAD - promedio.edad) / desviacion.edad,
    VALORES_ATIPICOS_EDAD = ifelse(abs(Z_SCORE_EDAD) > 1.69, "SI", "NO"),
    Z_SCORE_SALARIO= (EDAD - promedio.salario) / desviacion.salario,
    VALORES_ATIPICOS_SALARIO = ifelse(abs(Z_SCORE_SALARIO) > 1.69, "SI", "NO")
  )

head(df.modificada)
```
  
  ## 4. Valores faltantes 

    
```{r}
valores.nulos <- colSums(is.na(df.modificada))
tamanio <- nrow(df.modificada)
porcentaje.por.columna <- valores.nulos / tamanio * 100
porcentaje.por.columna
```
  ## 5. Imputación de datos
```{r}
  mediana.edad <- median(df$EDAD, na.rm = TRUE)
  mediana.salario <- median(df$SALARIO, na.rm = TRUE)
  moda.tipo <- df %>%
      count(TIPO_ASEGURAMIENTO) %>%
      arrange(desc(n)) %>%
      slice(1) %>%
      pull(TIPO_ASEGURAMIENTO)


df.modificada <- df.modificada %>%
  mutate(
    EDAD = if_else(
      is.na(EDAD),
      mediana.edad,
      EDAD
    ),
    SALARIO = if_else(
      is.na(SALARIO),
      mediana.salario, 
      SALARIO
    ), 
    TIPO_ASEGURAMIENTO = if_else(
      is.na(TIPO_ASEGURAMIENTO), 
      moda.tipo, 
      TIPO_ASEGURAMIENTO
    )
  )


```
  
  #6. Gráficos de individuos por categoría
  
  Para sexo:
```{r}
df.modificada %>%
  ggplot(aes(x = SEXO)) +
  geom_bar(fill = "pink", width = 0.4) +
  theme_minimal() +
  labs(
    title = "Conteo de individuos por sexo",
    x = "Sexo",
    y = "Frecuencia"
  )


```
 Para tipo de aseguramiento 
```{r}

  df.modificada %>%
  ggplot(aes(x = TIPO_ASEGURAMIENTO)) +
  geom_bar(fill = "pink", width = 0.4) +
  coord_flip() +
  theme_minimal() +
  labs(
    title = "Individuos por tipo de aseguramiento",
    x = "Aseguramiento",
    y = "Frecuencia"
  ) 
  # theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

Para sector: 
```{r}

  df.modificada %>%
  ggplot(aes(x = SECTOR)) +
  geom_bar(fill = "pink", width = 0.4) +
  theme_minimal() +
  labs(
    title = "Conteo de individuos por sector",
    x = "Sector",
    y = "Frecuencia"
  )
```
Para indicador activo
```{r}

  df.modificada %>%
  ggplot(aes(x = INDICADOR_ACTIVO)) +
  geom_bar(fill = "pink", width = 0.4) +
  theme_minimal() +
  labs(
    title = "Conteo de individuos por asegurado activo",
    x = "Indicador Activo",
    y = "Frecuencia"
  )
```
  Para indicador extranjero: 
```{r}

  df.modificada %>%
  ggplot(aes(x = INDICADOR.EXTRANJERO)) +
  geom_bar(fill = "pink", width = 0.4) +
  theme_minimal() +
  labs(
    title = "Conteo de individuos por extranjero",
    x = "Indicador extranjero",
    y = "Frecuencia"
  )

```
  
Para indicador moroso: 

```{r}

  df.modificada %>%
  ggplot(aes(x = INDICADOR_MOROSO)) +
  geom_bar(fill = "pink", width = 0.4) +
  theme_minimal() +
  labs(
    title = "Conteo de individuos por indicador de morosidad",
    x = "Indicador moroso",
    y = "Frecuencia"
  )
```

  ## 7- Gráficos de porcentaje de morosidad por categoría númerica
  
  Para sexo: 

```{r}

morosidad.por.sexo <- df.modificada %>%
  group_by(SEXO) %>%
  summarise(
    total = n(),
    morosos = sum(INDICADOR_MOROSO == "SI"),
    porcentaje = morosos / total
  )

ggplot(morosidad.por.sexo, aes(x = SEXO, y = porcentaje)) +
  geom_col(fill = "pink", width = 0.5) +
  scale_y_continuous(labels = percent) +
  theme_minimal() +
  labs(
    title = "Porcentaje de morosidad por sexo",
    x = "Sexo",
    y = "Porcentaje"
  )


```

  
  Para tipo de aseguramiento: 
  
```{r}
morosidad.por.aseguramiento <- df.modificada %>%
  group_by(TIPO_ASEGURAMIENTO) %>%
  summarise(
    total = n(),
    morosos = sum(INDICADOR_MOROSO == "SI"),
    porcentaje = morosos / total
  )

ggplot(morosidad.por.aseguramiento, aes(x = TIPO_ASEGURAMIENTO, y = porcentaje)) +
  geom_col(fill = "pink", width = 0.5) +
  scale_y_continuous(labels = percent) +
  coord_flip() +
  theme_minimal() +
  labs(
    title = "Porcentaje por aseguramiento",
    x = "Tipo de aseguramiento",
    y = "Porcentaje"
  )
```
  Para sector: 
```{r}
morosidad.por.sector <- df.modificada %>%
  group_by(SECTOR) %>%
  summarise(
    total = n(),
    morosos = sum(INDICADOR_MOROSO == "SI"),
    porcentaje = morosos / total
  )

ggplot(morosidad.por.sector, aes(x = SECTOR, y = porcentaje)) +
  geom_col(fill = "pink", width = 0.5) +
  scale_y_continuous(labels = percent) +
  theme_minimal() +
  labs(
    title = "Porcentaje de morosidad por sector",
    x = "Sector",
    y = "Porcentaje"
  )

```
Para indicador activo

```{r}
morosidad.por.activo <- df.modificada %>%
  group_by(INDICADOR_ACTIVO) %>%
  summarise(
    total = n(),
    morosos = sum(INDICADOR_MOROSO == "SI"),
    porcentaje = morosos / total
  )

ggplot(morosidad.por.activo, aes(x = INDICADOR_ACTIVO, y = porcentaje)) +
  geom_col(fill = "pink", width = 0.5) +
  scale_y_continuous(labels = percent) +
  theme_minimal() +
  labs(
    title = "Porcentaje de morosidad por indicador de activo",
    x = "Indicador activo",
    y = "Porcentaje"
  )

```

Para indicar extrnajero; 

```{r}
morosidad.por.extranjero <- df.modificada %>%
  group_by(INDICADOR.EXTRANJERO) %>%
  summarise(
    total = n(),
    morosos = sum(INDICADOR_MOROSO == "SI"),
    porcentaje = morosos / total
  )

ggplot(morosidad.por.extranjero, aes(x = INDICADOR.EXTRANJERO, y = porcentaje)) +
  geom_col(fill = "pink", width = 0.5) +
  scale_y_continuous(labels = percent) +
  theme_minimal() +
  labs(
    title = "Porcentaje de morosidad por indicador de extranjero",
    x = "Indicador extranjero",
    y = "Porcentaje"
  )
```

## 8- Gráficos de variables númericas para ver morosidad

Para edad: 

Se agrupan en base en intervalos de 10 años, igual que en excel, pero esta vez vamos a ver los 9 grupos.
```{r}
df.modificada <- df.modificada %>% 
  mutate(
    EDAD_GRUPO = cut(
      EDAD,
      breaks = seq(0, 100, by = 10),
      right = FALSE,
      include.lowest = TRUE
    )
  )
df.modificada %>% 
  ggplot(aes(x = EDAD_GRUPO, fill = INDICADOR_MOROSO)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  labs(
    title = "Proporción de morosidad por edad",
    x = "Edad",
    y = "Proporción",
    fill = "Moroso"
  )


```
Para salario: 

Loa ordenamos por cauntiles, igual que en la parte de excel.

```{r}
qs <- quantile(df.modificada$SALARIO, probs = c(0, 0.25, 0.5, 0.75, 1), na.rm = TRUE)
qs

df.modificada <- df.modificada %>%
  mutate(
    SALARIO_GRUPO = cut(
      SALARIO,
      breaks = qs,
      include.lowest = TRUE,
      labels = c("Bajo", "Medio-bajo", "Medio-alto", "Alto")
    )
  )
df.modificada %>% 
  ggplot(aes(x = SALARIO_GRUPO, fill = INDICADOR_MOROSO)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  theme_minimal() +
  labs(
    title = "Proporción de morosidad por salario",
    x = "Salario",
    y = "Proporción",
    fill = "Moroso"
  )
```

## 10 -Análisis de árbol para ver la relación con la variable de indicador de morosidad

```{r}
library(rpart)
library(rpart.plot)

df.modificada <- 
  df.modificada %>% 
  select(-IDENTIFICACION)
```


```{r}
df.modificada$INDICADOR_MOROSO <- factor(df.modificada$INDICADOR_MOROSO)


tree <- rpart(INDICADOR_MOROSO ~ ., data = df.modificada)
rpart.plot(tree)
```

